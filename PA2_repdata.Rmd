---
title: "Most Harmful Events with Respect to Population Health and The Events with Greatest Economic Consequences"
author: "Nazmi Anik"
date: "Monday, September 21, 2015"
output: html_document
---

## Synopsis  

## Loading and Preprocessing the Data  

The data was obtained from the [Coursera Assignment Page] (https://class.coursera.org/repdata-032/human_grading/view/courses/975145/assessments/4/submissions). The [data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2) for this assignment came in the form of a comma-separated-value file compressed via the bzip2 algorithm to reduce its size.  

### Reading the Data  

First the raw data is downloaded from the [link](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2) that was provided.  
```{r download, echo=TRUE, cache=TRUE}
#if file is not already downloaded, download it
if(!file.exists("stormdata.csv.bz2")){
    url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
    download.file(url, destfile = "stormdata.csv.bz2", mode = "wb")
}
```
  
The data, then was read into a data frame using the *read.csv* function.  
```{r read, echo=TRUE, cache=TRUE}
#read the data into a data frame
storm <- read.csv("stormdata.csv.bz2", stringsAsFactors=FALSE, na.strings="NA")

head(storm)
```

### Processing the Data  

The *BGN_DATE* column class is changed from *chr* into *Date* to allow easier analysis of the data frame. Also the *EVTYPE* column is converted into factor class for easy analysis.  
```{r convert, echo=TRUE, cache=TRUE}
#convert beginning date column into date class
storm[,2] <- as.Date(storm[,2],format='%m/%d/%Y %H:%M:%S')
```

Data is subset with the relevant columns. Since we are looking at data across the United States, location data is irrelevant. *Injuries* and *Fatalities* columns provide data about population health. *Property Damage* and *Crop Damage* columns provide economic data. The *Event Type* column gives us which event caused the problems.  
```{r subset, echo=TRUE, cache=TRUE}
#subset all of the data with the selected columns
stormSub <- subset(storm, select=c(EVTYPE, BGN_DATE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP))
```

Let's also look at years that we want to include in the processing. Earlier years usually do not have accurate or well-kept data. It may prove worthwile to not include some earlier years in our analysis.  
```{r subsetyear, echo=TRUE, cache=TRUE, fig.height=6, fig.width=8}
#draw a histogram to see how much data was gathered each year
hist(stormSub$BGN_DATE, main="Data Points per Year", xlab="Date", ylab="Frequency", col = "steelblue", breaks = 25)
#subset all of the data with the dates after 1989
stormSub <- subset(stormSub, BGN_DATE > "1988-12-31")
```

Looking at *Property Damage Exponential* and *Crop Damage Exponential* columns to figure out a way to compute the corresponding damage amount.  
```{r unique, echo=TRUE, cache=TRUE}
paste(unique(stormSub$PROPDMGEXP))
paste(unique(stormSub$CROPDMGEXP))
```

In the EXP data columns, the "M" corresponds to a million, "B" to a billion, "K" to a thousand, "H" to a hundred, and the numbers correspond to the exponential value of 10 (as in "10 to the power of x"). We need to make these conversions so we can compare the data better. The remainder of the values "?,+,-" will be assumed as 0 to be able to ignore possibly wrong data recordings and simplify the analysis.  
```{r EXP, echo=TRUE, cache=TRUE}
#create a new column with numeral values for Property Damage Exponential column
stormSub$PROPEXP[stormSub$PROPDMGEXP == ""] <- 1
stormSub$PROPEXP[stormSub$PROPDMGEXP == "K"] <- 1000
stormSub$PROPEXP[stormSub$PROPDMGEXP == "M"] <- 1e+06
stormSub$PROPEXP[stormSub$PROPDMGEXP == "B"] <- 1e+09
stormSub$PROPEXP[stormSub$PROPDMGEXP == "m"] <- 1e+06
stormSub$PROPEXP[stormSub$PROPDMGEXP == "0"] <- 1
stormSub$PROPEXP[stormSub$PROPDMGEXP == "5"] <- 1e+05
stormSub$PROPEXP[stormSub$PROPDMGEXP == "6"] <- 1e+06
stormSub$PROPEXP[stormSub$PROPDMGEXP == "4"] <- 1e+04
stormSub$PROPEXP[stormSub$PROPDMGEXP == "2"] <- 100
stormSub$PROPEXP[stormSub$PROPDMGEXP == "3"] <- 1000
stormSub$PROPEXP[stormSub$PROPDMGEXP == "h"] <- 100
stormSub$PROPEXP[stormSub$PROPDMGEXP == "7"] <- 1e+07
stormSub$PROPEXP[stormSub$PROPDMGEXP == "H"] <- 100
stormSub$PROPEXP[stormSub$PROPDMGEXP == "1"] <- 10
stormSub$PROPEXP[stormSub$PROPDMGEXP == "8"] <- 1e+08
#assume 0 for other values
stormSub$PROPEXP[stormSub$PROPDMGEXP == "+"] <- 0
stormSub$PROPEXP[stormSub$PROPDMGEXP == "-"] <- 0
stormSub$PROPEXP[stormSub$PROPDMGEXP == "?"] <- 0
#create a new column with numeral values for Crop Damage Exponential column
stormSub$CROPEXP[stormSub$CROPDMGEXP == ""] <- 1
stormSub$CROPEXP[stormSub$CROPDMGEXP == "K"] <- 1000
stormSub$CROPEXP[stormSub$CROPDMGEXP == "M"] <- 1e+06
stormSub$CROPEXP[stormSub$CROPDMGEXP == "B"] <- 1e+09
stormSub$CROPEXP[stormSub$CROPDMGEXP == "m"] <- 1e+06
stormSub$CROPEXP[stormSub$CROPDMGEXP == "0"] <- 1
stormSub$CROPEXP[stormSub$CROPDMGEXP == "k"] <- 1000
stormSub$CROPEXP[stormSub$CROPDMGEXP == "2"] <- 100
#assume 0 for other values
stormSub$CROPEXP[stormSub$CROPDMGEXP == "?"] <- 0
```

Now, we will create a new column with the multiplication of *PROPDMG* column and *PROPEXP* columns. We will do the same for the Crop Damage data.  
```{r mutiply, echo=TRUE, cache=TRUE}
stormSub$PropDamage <- stormSub$PROPDMG * stormSub$PROPEXP
stormSub$CropDamage <- stormSub$CROPDMG * stormSub$CROPEXP
```

We will now subset this data frame to reduce the number of columns as we no longer need the columns such as *PROPEXP*.  
```{r lesscolumns, echo=TRUE, cache=TRUE}
stormR <- subset(stormSub, select=c(EVTYPE, BGN_DATE, FATALITIES, INJURIES, PropDamage, CropDamage))
```
  
According to the National Weather Service, there are 48 event types. Our data frame shows 945 data frames. We need to find a way to reduce the 945 to 48 as much as we can.  

We could start by reducing our data frame by removing rows where injuries, fatalities and property and crop damage is equal to 0. Storm Effects to Population Health can be measured from fatalities and injuries counts. Economic effects can be measured from property damage and crop damage values. We can group the relevant non-zero columns in separate data frames.  
```{r lessrows, echo=TRUE, cache=TRUE}
stormHealth <- subset(stormR, (FATALITIES != 0) | (INJURIES != 0))
stormEcon <- subset(stormR, (PropDamage != 0) | (CropDamage != 0))
```